<!DOCTYPE html><html lang="zh-CN"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-select=no">    <title>æ€æˆç§¯åˆ†å­˜æŠ˜ Pro Max 2026</title>    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>    <style>        :root {            --p-color: #4A90E2;            --p-light: #E3F2FD;            --a-color: #FFD600;            --s-color: #7ED321;            --d-color: #FF5252;            --t-main: #4A4A4A;            --t-sub: #9B9B9B;            --white: #ffffff;            --soft-yellow: #FFF9C4;            --bg-body: #F0F7FF;        }
        @keyframes floating {            0% { transform: translateY(0px) rotate(0deg); }            50% { transform: translateY(-15px) rotate(1deg); }            100% { transform: translateY(0px) rotate(0deg); }        }
        @keyframes pulse-yellow {            0% { box-shadow: 0 0 0 0 rgba(255, 214, 0, 0.6); }            70% { box-shadow: 0 0 0 20px rgba(255, 214, 0, 0); }            100% { box-shadow: 0 0 0 0 rgba(255, 214, 0, 0); }        }
        @keyframes scan-line {            0% { top: 0%; }            50% { top: 100%; }            100% { top: 0%; }        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }                body {            background-color: var(--bg-body);            background-image:                 url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M9 15c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm77 46c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-7-42c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-1 74c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-46-7c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm7-46c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm6-37c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-44-1c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm1 14c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm76 58c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3-68c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-73 30c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm51 57c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm23-67c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-58 33c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm63 31c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-49-1c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-18-10c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm10-53c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm58 6c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-67 21c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-9 66c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm91-32c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-58-23c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm33 37c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-52-17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm35 53c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm56-49c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-81-44c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm11 67c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm31-2c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z' fill='%234a90e2' fill-opacity='0.04' fill-rule='evenodd'/%3E%3C/svg%3E");            font-family: "PingFang SC", "Quicksand", "Microsoft YaHei", sans-serif;            margin: 0; padding: 0; min-height: 100vh; overflow-x: hidden;            color: var(--t-main); display: flex; flex-direction: column; align-items: center;        }
        .desktop-container {            width: 100%; max-width: 600px; min-height: 100vh;            background: rgba(240, 247, 255, 0.4);            position: relative; box-shadow: 0 0 100px rgba(0,0,0,0.05);        }
        @media (min-width: 1024px) {            body { background-color: #DDEBFF; padding: 40px 0; }            .desktop-container {                 border-radius: 50px; height: 90vh; min-height: 800px; overflow-y: auto;                 scrollbar-width: none; border: 12px solid white;            }            .desktop-container::-webkit-scrollbar { display: none; }            .tab-bar { position: absolute; bottom: 30px; width: calc(100% - 50px); left: 25px; }            .fab { position: absolute; bottom: 130px; right: 30px; }        }
        .app-header {            background: linear-gradient(135deg, var(--p-color) 0%, #64B5F6 100%);            padding: 65px 25px 110px; color: white;            border-bottom-left-radius: 45px; border-bottom-right-radius: 45px;            position: relative; overflow: hidden;            box-shadow: 0 12px 30px rgba(74, 144, 226, 0.3);        }
        .app-header::after {            content: ""; position: absolute; bottom: -40px; right: -20px;            width: 160px; height: 160px; background: rgba(255, 255, 255, 0.1); border-radius: 50%;        }
        .header-content { position: relative; z-index: 2; }        .header-content h1 { margin: 0; font-size: 2.3rem; font-weight: 950; letter-spacing: 2px; }        .header-content p { margin: 10px 0 0; font-size: 0.95rem; opacity: 0.95; background: rgba(0,0,0,0.15); display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: 700; }
        .main-view { padding: 0 25px; margin-top: -75px; padding-bottom: 140px; }        .page { display: none; }        .page.active { display: block; animation: animate__fadeInUp 0.7s cubic-bezier(0.19, 1, 0.22, 1); }
        .hero-card {            background: var(--white); border-radius: 40px; padding: 45px 20px;            text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.06);            border: 8px solid #E1F5FE; margin-bottom: 35px;            position: relative; animation: floating 4.5s ease-in-out infinite;        }
        .hero-label { font-size: 1.05rem; color: var(--t-sub); font-weight: 800; text-transform: uppercase; }        .hero-val { font-size: 5rem; font-weight: 950; color: var(--p-color); margin: 15px 0; font-family: 'Arial Rounded MT Bold', sans-serif; text-shadow: 4px 4px 0px var(--p-light); }        .hero-sub { display: inline-block; background: var(--soft-yellow); color: #E65100; padding: 12px 30px; border-radius: 60px; font-weight: 900; font-size: 1.2rem; border: 3px dashed var(--a-color); }
        .filter-row { display: flex; gap: 12px; overflow-x: auto; padding: 10px 0 30px; scrollbar-width: none; }        .filter-row::-webkit-scrollbar { display: none; }        .filter-item {            white-space: nowrap; padding: 14px 25px; border-radius: 25px;            background: white; font-size: 0.95rem; color: var(--t-sub);            font-weight: 800; cursor: pointer; transition: 0.3s;            border: 2.5px solid #F1F5F9;        }        .filter-item.active { background: var(--a-color); color: var(--t-main); border-color: var(--a-color); transform: scale(1.05); box-shadow: 0 10px 20px rgba(255, 214, 0, 0.4); }
        .card {            background: var(--white); border-radius: 32px; padding: 28px;            margin-bottom: 22px; box-shadow: 0 12px 25px rgba(0,0,0,0.03);            border: 3px solid #F8FAFC; transition: 0.25s;        }        .card:active { transform: scale(0.98); }
        .task-node { display: flex; justify-content: space-between; align-items: center; }        .task-left .t-name { font-size: 1.2rem; font-weight: 900; color: var(--t-main); margin-bottom: 6px; display: block; }        .task-left .t-meta { font-size: 0.9rem; color: var(--t-sub); font-weight: 700; }        .task-stars { color: var(--a-color); font-size: 1.1rem; margin-top: 10px; letter-spacing: 3px; }
        .btn { border: none; border-radius: 22px; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; }        .btn-p { background: var(--p-color); color: white; width: 100%; padding: 20px; font-size: 1.25rem; box-shadow: 0 8px 0px #3273C2; }        .btn-p:active { transform: translateY(4px); box-shadow: 0 2px 0px #3273C2; }                .btn-done { background: var(--s-color); color: white; padding: 14px 28px; font-size: 1rem; box-shadow: 0 6px 0px #5E9E1C; }        .btn-done:active { transform: translateY(3px); box-shadow: 0 1px 0px #5E9E1C; }                .btn-del { background: #FFF1F1; color: var(--d-color); padding: 12px; font-size: 1.3rem; border-radius: 18px; border: 2px solid #FFE4E4; }
        .redeem-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 25px 0; }        .redeem-item {            background: white; border: 4px solid #F1F5F9; border-radius: 28px;            padding: 30px 10px; text-align: center; cursor: pointer; transition: 0.3s;        }        .redeem-item:hover { border-color: var(--p-color); background: var(--p-light); transform: translateY(-5px); }        .redeem-item .r-money { display: block; font-size: 1.5rem; font-weight: 950; color: var(--p-color); }        .redeem-item .r-pts { font-size: 0.85rem; color: var(--t-sub); font-weight: 800; margin-top: 6px; }
        .tab-bar {            position: fixed; bottom: 30px; left: 25px; right: 25px;            background: rgba(255, 255, 255, 0.98); height: 90px;            display: flex; border-radius: 35px; backdrop-filter: blur(15px);            box-shadow: 0 20px 45px rgba(0,0,0,0.12); z-index: 1000; border: 3px solid white;        }        .tab-link { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.9rem; color: #B2C1D1; font-weight: 800; transition: 0.3s; }        .tab-link i { font-style: normal; font-size: 2.1rem; margin-bottom: 4px; transition: 0.4s; }        .tab-link.active { color: var(--p-color); }        .tab-link.active i { transform: scale(1.25) translateY(-8px); }
        .fab {            position: fixed; right: 35px; bottom: 140px; width: 85px; height: 85px;            background: var(--a-color); border-radius: 50%; color: var(--t-main);            display: flex; align-items: center; justify-content: center; font-size: 3rem;            box-shadow: 0 15px 30px rgba(255, 214, 0, 0.45); z-index: 900;            animation: pulse-yellow 2.5s infinite; border: 6px solid white;        }
        .modal {            position: fixed; top: 0; left: 0; right: 0; bottom: 0;            background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px);            z-index: 2000; display: none; align-items: center; justify-content: center;        }        .modal-inner {            background: white; width: 92%; max-width: 450px; border-radius: 50px;            padding: 40px; animation: animate__bounceInUp 0.6s; border: 12px solid var(--p-light);        }
        .field { width: 100%; padding: 22px; border-radius: 25px; border: 3px solid #F1F5F9; background: #F8FAFC; font-size: 1.2rem; font-weight: 800; color: var(--t-main); }
        .scan-layer {            position: fixed; top: 0; left: 0; right: 0; bottom: 0;            background: #1A202C; z-index: 5000; display: none; flex-direction: column;            align-items: center; justify-content: center; color: white;        }        #video { width: 340px; height: 340px; border-radius: 50%; object-fit: cover; border: 12px solid var(--a-color); box-shadow: 0 0 60px rgba(255, 214, 0, 0.4); }        .scan-overlay { position: absolute; top: 50%; left: 50%; width: 340px; height: 340px; transform: translate(-50%,-50%); border-radius: 50%; overflow: hidden; }        .scan-line { position: absolute; width: 100%; height: 5px; background: var(--a-color); box-shadow: 0 0 20px var(--a-color); animation: scan-line 3s linear infinite; }
        .avatar-wrapper { width: 155px; height: 155px; margin: 0 auto 35px; position: relative; }        .avatar-img { width: 100%; height: 100%; border-radius: 50%; border: 8px solid white; box-shadow: 0 15px 30px rgba(0,0,0,0.12); object-fit: cover; }        .avatar-badge { position: absolute; bottom: 8px; right: 8px; background: var(--p-color); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 6px solid white; color: white; cursor: pointer; }
        .empty-state { text-align: center; padding: 70px 20px; color: var(--t-sub); font-weight: 800; }        .empty-state i { font-style: normal; font-size: 4.5rem; display: block; margin-bottom: 25px; opacity: 0.6; }    </style></head><body>
<div class="desktop-container">    <header class="app-header">        <div class="header-content">            <h1>æ€æˆç§¯åˆ†å­˜æŠ˜</h1>            <p id="time-tag">æ­£åœ¨æ ¡éªŒå®‰å…¨ç¯å¢ƒ...</p>        </div>    </header>
    <main class="main-view">        <section id="p-book" class="page active">            <div class="hero-card">                <span class="hero-label">å½“å‰å¯ç”¨èµ„äº§æ€»é¢</span>                <div class="hero-val" id="pts-show">0.00</div>                <div class="hero-sub" id="rmb-show">Â¥ 0.00</div>                <div style="margin-top:30px; font-size:1rem; color:var(--s-color); font-weight:900;" id="growth-info"></div>            </div>            <div id="logs-container"></div>        </section>
        <section id="p-task" class="page">            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding:0 10px;">                <h3 style="margin:0; font-size:1.5rem; font-weight:900;">æŒ‘æˆ˜é¡¹ç›®åº“</h3>                <span id="task-count" style="background:var(--p-light); color:var(--p-color); padding:5px 15px; border-radius:15px; font-weight:950; font-size:0.9rem;">0 é¡¹</span>            </div>            <div class="filter-row">                <div class="filter-item active" onclick="applySort(0)">æ™ºèƒ½æ¨è</div>                <div class="filter-item" onclick="applySort(1)">é­”é¬¼éš¾åº¦</div>                <div class="filter-item" onclick="applySort(2)">æ–°æ‰‹å…¥é—¨</div>                <div class="filter-item" onclick="applySort(3)">æœ€é«˜å¥–åŠ±</div>            </div>            <div id="tasks-container"></div>        </section>
        <section id="p-redeem" class="page">            <div class="card" style="padding: 40px 30px;">                <h3 style="margin:0 0 35px; text-align: center; font-size:1.5rem; font-weight:900;">å¿«é€Ÿå…‘æ¢ä¸­å¿ƒ</h3>                <div class="redeem-grid">                    <div class="redeem-item" onclick="redeemGate(10)"><span class="r-money">1å…ƒ</span><span class="r-pts">10ç§¯åˆ†</span></div>                    <div class="redeem-item" onclick="redeemGate(50)"><span class="r-money">5å…ƒ</span><span class="r-pts">50ç§¯åˆ†</span></div>                    <div class="redeem-item" onclick="redeemGate(100)"><span class="r-money">10å…ƒ</span><span class="r-pts">100ç§¯åˆ†</span></div>                    <div class="redeem-item" onclick="redeemGate(200)"><span class="r-money">20å…ƒ</span><span class="r-pts">200ç§¯åˆ†</span></div>                    <div class="redeem-item" onclick="redeemGate(500)"><span class="r-money">50å…ƒ</span><span class="r-pts">500ç§¯åˆ†</span></div>                    <div class="redeem-item" onclick="redeemGate(1000)"><span class="r-money">100å…ƒ</span><span class="r-pts">1000ç§¯åˆ†</span></div>                </div>                <div style="border-top:5px dashed #F1F5F9; padding-top:40px; margin-top:30px">                    <div style="margin-bottom:15px;"><label style="font-size:1rem; color:var(--t-sub); font-weight:900; padding-left:15px;">å¤§é¢è‡ªå®šä¹‰å…‘æ¢ (>100å…ƒ)</label></div>                    <input type="number" id="c-money" class="field" placeholder="è¯·è¾“å…¥æç°é‡‘é¢...">                    <button class="btn btn-p" style="margin-top:25px;" onclick="handleCustomRedeem()">ç¡®è®¤å‘èµ·ç”³è¯·</button>                </div>            </div>        </section>
        <section id="p-me" class="page">            <div class="card" style="text-align:center; padding: 50px 35px;">                <div class="avatar-wrapper">                    <img id="avatar" class="avatar-img" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23E3F2FD'/%3E%3Ccircle cx='50' cy='40' r='20' fill='%234A90E2'/%3E%3Cpath d='M20 85c0-15 15-25 30-25s30 10 30 25' fill='%234A90E2'/%3E%3C/svg%3E">                    <div class="avatar-badge" onclick="document.getElementById('avatar-in').click()">ğŸ“¸</div>                </div>                <input type="file" id="avatar-in" hidden accept="image/*" onchange="goCrop(this)">                <h2 id="name-show" style="margin:0 0 12px; font-size: 2.2rem; font-weight:950;">æ€æˆ</h2>                <p style="color:var(--t-sub); margin-bottom:45px; font-weight:800; letter-spacing:1px;">é¦–å¸­èµ„äº§æ¶æ„å¸ˆ</p>                <div style="text-align:left">                    <div style="margin-bottom:12px;"><label style="font-size:1rem; color:var(--t-sub); font-weight:900; padding-left:15px;">è´¦æˆ·åç§°ä¿®æ”¹</label></div>                    <input type="text" id="edit-name" class="field" style="margin-bottom:30px">                    <button class="btn btn-p" onclick="updateProfile()">æ›´æ–°è´¦æˆ·èµ„æ–™</button>                    <button class="btn" style="width:100%; margin-top:30px; height:70px; font-weight:950; background:#FFF5F5; color:var(--d-color); border:4px solid #FFE4E4; border-radius:28px;" onclick="clearAll()">âš ï¸ é”€æ¯æ­¤è®¾å¤‡æ‰€æœ‰æ•°æ®</button>                </div>            </div>        </section>    </main>
    <div class="fab animate__animated animate__bounceIn" id="add-fab" onclick="showAddModal()">+</div>
    <nav class="tab-bar">        <div class="tab-link active" onclick="nav('book', this)"><i>ğŸ“–</i>è´¦æœ¬</div>        <div class="tab-link" onclick="nav('task', this)"><i>ğŸ¯</i>æŒ‘æˆ˜</div>        <div class="tab-link" onclick="nav('redeem', this)"><i>ğŸ§§</i>æç°</div>        <div class="tab-link" onclick="nav('me', this)"><i>ğŸ˜</i>æˆ‘</div>    </nav></div>
<div class="modal" id="modal-add">    <div class="modal-inner">        <h3 id="modal-head" style="margin-top:0; font-size:1.8rem; text-align:center; font-weight:950;">æ–°å¢é¡¹ç›®</h3>        <div id="modal-body"></div>        <div style="display:flex; gap:20px; margin-top:40px">            <button class="btn" style="flex:1; background:#F8FAFC; color:var(--t-sub); border-radius:25px; font-weight:900; border:3px solid #EDF2F7;" onclick="hideModals()">å–æ¶ˆ</button>            <button class="btn btn-p" style="flex:2; border-radius:25px; margin-top:0;" id="modal-ok">ç¡®å®šæ·»åŠ </button>        </div>    </div></div>
<div class="modal" id="modal-crop">    <div class="modal-inner" style="max-width: 540px;">        <h3 style="margin-top:0; font-weight:950;">è£å‰ªæ–°å¤´åƒ</h3>        <div style="width:100%; height:340px; background:#F1F5F9; border-radius:30px; overflow:hidden; margin:25px 0; border:4px dashed #CBD5E0;">            <img id="target-img" style="max-width:100%;">        </div>        <button class="btn btn-p" onclick="doSaveAvatar()">å®Œæˆå¹¶ä¿å­˜å¤´åƒ</button>        <button class="btn" style="width:100%; margin-top:15px; background:none; color:var(--t-sub); border:none; height:50px; font-weight:800;" onclick="hideModals()">æ”¾å¼ƒä¿®æ”¹</button>    </div></div>
<div class="scan-layer" id="scanner">    <div style="position:relative">        <video id="video" autoplay playsinline></video>        <div class="scan-overlay">            <div class="scan-line"></div>        </div>    </div>    <h2 style="margin-top:50px; font-size:2.2rem; font-weight:950; letter-spacing:2px;">ç”Ÿç‰©å¯†é’¥åŒ¹é…ä¸­</h2>    <p id="scan-txt" style="font-size:1.2rem; color:var(--a-color); font-weight:900;">è¯·æ­£å¯¹é«˜æ¸…æ‘„åƒå¤´ï¼Œä¿æŒé™æ­¢</p>    <div style="width:300px; height:16px; background:rgba(255,255,255,0.1); border-radius:15px; margin-top:40px; overflow:hidden; border:2px solid rgba(255,255,255,0.1)">        <div id="scan-prog" style="width:0; height:100%; background:var(--a-color); transition: width 0.2s linear; box-shadow: 0 0 25px var(--a-color);"></div>    </div></div>
<script>let core = JSON.parse(localStorage.getItem('SICHE_PRO_V4_2026')) || {    balance: 0.0, records: [], tasks: [], user: { name: 'æ€æˆ', avatar: '', lang: 'zh' }, lastTick: Date.now()};let activeTab = 'book';let activeSort = 0;let starRank = 5;let cropper = null;let payPts = 0;

// ã€æ ¸å¿ƒè¡¥ä¸ã€‘æ–°å¢å…¨å±€æ§åˆ¶å˜é‡
let lastRedeemTime = 0;
let isScanning = false; 
let scanTimer = null; // æ˜¾å¼å£°æ˜å®šæ—¶å™¨å¥æŸ„
let currentScanId = 0; // ä»»åŠ¡IDæ ¡éªŒ

function start() {    render(); doGrowth();    setInterval(doGrowth, 60000);    faceapi.nets.tinyFaceDetector.loadFromUri('https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights');    document.getElementById('time-tag').innerText = "2026.02.04 | èµ„äº§å®‰å…¨åŠ å¯†è¿è¡Œä¸­";}
function doGrowth() {    const now = Date.now();    const dayGap = (now - core.lastTick) / (1000 * 60 * 60 * 24);    if (core.balance >= 10 && dayGap > 0.0001) {        const bonus = core.balance * 0.000025 * dayGap;         if (bonus >= 0.01) {            core.balance += bonus;            core.records.unshift({ id: Date.now(), type: 'in', amt: bonus, msg: 'ğŸ’ èµ„äº§è‡ªåŠ¨å¢å€¼æ”¶ç›Š', time: "åˆšæ‰" });            core.lastTick = now;            save();        }    } else if(core.balance < 10) core.lastTick = now;}
function save() { localStorage.setItem('SICHE_PRO_V4_2026', JSON.stringify(core)); render(); }
function render() {    document.getElementById('pts-show').innerText = core.balance.toFixed(2);    document.getElementById('rmb-show').innerText = 'Â¥ ' + (core.balance / 10).toFixed(2);    document.getElementById('growth-info').innerText = core.balance >= 10 ? "âœ… èµ„äº§è‡ªåŠ¨å¢å€¼å¼•æ“å·²å°±ç»ª" : "";    document.getElementById('name-show').innerText = core.user.name;    document.getElementById('edit-name').value = core.user.name;    document.getElementById('task-count').innerText = `${core.tasks.length} é¡¹`;    if(core.user.avatar) document.getElementById('avatar').src = core.user.avatar;
    const lBox = document.getElementById('logs-container');    lBox.innerHTML = '';    if(core.records.length === 0) {        lBox.innerHTML = `<div class="empty-state"><i>ğŸ“œ</i>å°šæ— å†å²è´¦å•æ˜ç»†</div>`;    } else {        core.records.slice(0, 25).forEach(r => {            lBox.innerHTML += `                <div class="card task-node animate__animated animate__fadeIn">                    <div class="task-left">                        <span class="t-name" style="font-size:1.1rem">${r.msg}</span>                        <small style="color:var(--t-sub); font-weight:850;">${r.time}</small>                    </div>                    <div style="font-weight:950; font-size:1.5rem; color:${r.type==='in'?'var(--s-color)':'var(--d-color)'}">                        ${r.type==='in'?'+':'-'}${r.amt.toFixed(2)}                    </div>                </div>`;        });    }
    const tBox = document.getElementById('tasks-container');    tBox.innerHTML = '';    if(core.tasks.length === 0) {        tBox.innerHTML = `<div class="empty-state"><i>ğŸ¯</i>å½“å‰é¡¹ç›®åº“ä¸ºç©º<br><small style="font-size:1rem; opacity:0.8; margin-top:10px; display:block;">ç‚¹å‡»ä¸‹æ–¹â€œ+â€å¼€å¯æ–°æŒ‘æˆ˜</small></div>`;    } else {        let pool = [...core.tasks].map((t, i) => ({...t, oldIdx: i}));        if(activeSort === 1) pool.sort((a,b) => b.star - a.star);        else if(activeSort === 2) pool.sort((a,b) => a.star - b.star);        else if(activeSort === 3) pool.sort((a,b) => b.pts - a.pts);        else pool.reverse();
        pool.forEach(t => {            tBox.innerHTML += `                <div class="card task-node animate__animated animate__fadeIn">                    <div class="task-left" style="flex:1; padding-right:15px;">                        <span class="t-name">${t.name}</span>                        <span class="t-meta">é¢åº¦ï¼š<b style="color:var(--p-color); font-size:1.1rem;">+${t.pts}</b> | ${t.note || 'æš‚æ— å¤‡æ³¨'}</span>                        <div class="task-stars">${"â­".repeat(t.star)}</div>                    </div>                    <div style="display:flex; flex-direction:column; gap:12px; align-items:flex-end;">                        <button class="btn btn-done" onclick="finishTask(${t.oldIdx})">å®Œæˆ</button>                        <button class="btn btn-del" onclick="killTask(${t.oldIdx})">ğŸ—‘ï¸</button>                    </div>                </div>`;        });    }}
function nav(p, el) {    activeTab = p;    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));    document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));    document.getElementById('p-'+p).classList.add('active');    el.classList.add('active');    document.getElementById('add-fab').style.display = (p==='book'||p==='task') ? 'flex' : 'none';}
function applySort(s) {    activeSort = s;    document.querySelectorAll('.filter-item').forEach((it, i) => i===s ? it.classList.add('active') : it.classList.remove('active'));    render();}
function showAddModal() {    const b = document.getElementById('modal-body');    const h = document.getElementById('modal-head');    b.innerHTML = '';    if(activeTab === 'book') {        h.innerText = "æ‰‹åŠ¨è°ƒæ•´è´¦ç›®";        b.innerHTML = `            <div style="margin-bottom:20px"><label style="font-size:0.95rem; font-weight:950; color:var(--t-sub); margin-bottom:10px; display:block;">è®°è´¦æ–¹å‘</label>            <select id="f-dir" class="field"><option value="in">æ”¶å…¥å¢åŠ  (+)</option><option value="out">æ”¯å‡ºå‡å°‘ (-)</option></select></div>            <div style="margin-bottom:20px"><label style="font-size:0.95rem; font-weight:950; color:var(--t-sub); margin-bottom:10px; display:block;">ç§¯åˆ†æ•°é¢</label>            <input type="number" id="f-val" class="field" placeholder="0.00"></div>            <div style="margin-bottom:20px"><label style="font-size:0.95rem; font-weight:950; color:var(--t-sub); margin-bottom:10px; display:block;">å˜åŠ¨è¯´æ˜</label>            <input type="text" id="f-msg" class="field" placeholder="æè¿°è¿™ç¬”ç§¯åˆ†å˜åŠ¨..."></div>        `;        document.getElementById('modal-ok').onclick = () => {            const val = parseFloat(document.getElementById('f-val').value);            const dir = document.getElementById('f-dir').value;            if(val > 0) {                core.balance = dir==='in' ? core.balance + val : core.balance - val;                core.records.unshift({ id: Date.now(), type: dir, amt: val, msg: document.getElementById('f-msg').value || 'ç³»ç»Ÿå˜æ›´', time: "åˆšåˆš" });                save(); hideModals();            }        };    } else {        h.innerText = "è§„åˆ’æ–°æŒ‘æˆ˜";        b.innerHTML = `            <div style="margin-bottom:20px"><label style="font-size:0.95rem; font-weight:950; color:var(--t-sub); margin-bottom:10px; display:block;">é¡¹ç›®æ ‡é¢˜</label>            <input type="text" id="t-n" class="field" placeholder="æƒ³è¦è¾¾æˆä»€ä¹ˆç›®æ ‡ï¼Ÿ"></div>            <div style="margin-bottom:20px"><label style="font-size:0.95rem; font-weight:950; color:var(--t-sub); margin-bottom:10px; display:block;">å¥–åŠ±æ•°é¢</label>            <input type="number" id="t-p" class="field" placeholder="å¥–åŠ±åˆ†å€¼"></div>            <div style="margin-bottom:20px"><label style="font-size:0.95rem; font-weight:950; color:var(--t-sub); margin-bottom:10px; display:block;">éš¾åº¦è¯„ä¼°</label>            <div style="display:flex; justify-content:center; gap:20px; margin-top:15px" id="stars-wrap">                <span style="font-size:2.5rem; cursor:pointer; color:var(--a-color)" onclick="rank(1)">â­</span>                <span style="font-size:2.5rem; cursor:pointer; color:var(--a-color)" onclick="rank(2)">â­</span>                <span style="font-size:2.5rem; cursor:pointer; color:var(--a-color)" onclick="rank(3)">â­</span>                <span style="font-size:2.5rem; cursor:pointer; color:var(--a-color)" onclick="rank(4)">â­</span>                <span style="font-size:2.5rem; cursor:pointer; color:var(--a-color)" onclick="rank(5)">â­</span>            </div></div>            <div style="margin-bottom:20px"><label style="font-size:0.95rem; font-weight:950; color:var(--t-sub); margin-bottom:10px; display:block;">è¯¦ç»†è§„åˆ™</label>            <input type="text" id="t-o" class="field" placeholder="è¾¾æˆç›®æ ‡çš„å…·ä½“è¦æ±‚..."></div>        `;        starRank = 5;        document.getElementById('modal-ok').onclick = () => {            const n = document.getElementById('t-n').value;            const p = parseFloat(document.getElementById('t-p').value);            if(n && p) {                core.tasks.push({ name: n, pts: p, star: starRank, note: document.getElementById('t-o').value });                save(); hideModals();            }        };    }    document.getElementById('modal-add').style.display = 'flex';}
function rank(n) {    starRank = n;    const ss = document.querySelectorAll('#stars-wrap span');    ss.forEach((s, i) => s.style.opacity = i < n ? "1" : "0.2");}
function killTask(i) { if(confirm("ç¡®å®šè¦æ°¸ä¹…ç§»é™¤è¿™ä¸ªæŒ‘æˆ˜é¡¹å—ï¼Ÿ")) { core.tasks.splice(i, 1); save(); } }
function finishTask(i) {    const t = core.tasks[i];    core.balance += t.pts;    core.records.unshift({ id: Date.now(), type: 'in', amt: t.pts, msg: 'ğŸ¯ æˆå°±è¾¾æˆï¼š'+t.name, time: "åˆšæ‰" });    save(); alert("æŒ‘æˆ˜æˆåŠŸï¼å¥–åŠ±ç§¯åˆ†å·²æ³¨å…¥è´¦æˆ·ã€‚");}
function handleCustomRedeem() {    const m = parseFloat(document.getElementById('c-money').value);    if(m <= 100 || isNaN(m)) return alert("è‡ªå®šä¹‰å…‘æ¢é¢åº¦éœ€è¶…è¿‡ 100 å…ƒã€‚");    redeemGate(m * 10);}

// ã€è¡¥ä¸ä»£ç ã€‘å¼ºåˆ¶é˜²æ­¢æ‰£2æ¬¡é’±é€»è¾‘
function redeemGate(pts) {
    if (isScanning) return; 

    const now = Date.now();
    const wait = Math.ceil((30000 - (now - lastRedeemTime)) / 1000);
    if (now - lastRedeemTime < 30000) {
        alert(`ã€å®‰å…¨é™åˆ¶ã€‘30ç§’å†…ä»…é™æç°ä¸€æ¬¡ã€‚è¯·ç­‰å¾… ${wait} ç§’åå†è¯•ã€‚`);
        return;
    }

    if(core.balance < pts) return alert("å½“å‰ç§¯åˆ†èµ„äº§ä¸è¶³ï¼Œè¯·ç»§ç»­åŠªåŠ›å®ŒæˆæŒ‘æˆ˜ã€‚");
    
    payPts = pts;
    if(confirm(`å³å°†è¿›å…¥ç”Ÿç‰©è¯†åˆ«æ ¸éªŒæµç¨‹ï¼Œç¡®è®¤å…‘æ¢ ${pts} ç§¯åˆ†ï¼Ÿ`)) {
        isScanning = true; 
        currentScanId = Date.now(); // ç”Ÿæˆå”¯ä¸€ä»»åŠ¡ID
        startScan(currentScanId);
    }
}

async function startScan(taskId) {    
    const s = document.getElementById('scanner');    
    const v = document.getElementById('video');    
    const b = document.getElementById('scan-prog');
    
    // å¼ºåˆ¶æ¸…é™¤ä¹‹å‰çš„æ®‹ç•™å®šæ—¶å™¨
    if(scanTimer) clearInterval(scanTimer);

    try {        
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });        
        v.srcObject = stream;        
        s.style.display = 'flex';        
        let prog = 0;        
        
        scanTimer = setInterval(async () => {            
            const d = await faceapi.detectSingleFace(v, new faceapi.TinyFaceDetectorOptions());            
            if(d) {                
                prog += 4;                
                document.getElementById('scan-txt').innerText = "âœ… æ­£åœ¨æ ¡éªŒé¢éƒ¨ç”Ÿç‰©å¯†é’¥...";                
                document.getElementById('scan-txt').style.color = "var(--s-color)";            
            } else {                
                document.getElementById('scan-txt').innerText = "âš ï¸ æ£€å‡ºä¸­æ–­ï¼Œè¯·å¯¹å‡†è¯†åˆ«åŒº";                
                document.getElementById('scan-txt').style.color = "var(--d-color)";            
            }            
            b.style.width = prog + '%';

            // æˆåŠŸé€»è¾‘
            if(prog >= 100) {                
                clearInterval(scanTimer); // 1. ç«‹å³åœæ­¢å¾ªç¯
                scanTimer = null;

                // 2. äºŒæ¬¡èº«ä»½éªŒè¯ï¼šä»»åŠ¡IDä¸åŒ¹é…æˆ–å·²è¢«é‡Šæ”¾åˆ™ç›´æ¥æ‹¦æˆª
                if (taskId !== currentScanId || !isScanning) return; 

                // 3. æ‰§è¡Œæ‰£æ¬¾å¹¶é”å®šå…¨å±€
                isScanning = false;          
                core.balance -= payPts;                
                core.records.unshift({ id: Date.now(), type: 'out', amt: payPts, msg: 'ğŸ§§ èµ„äº§æå–ï¼šå…‘ç°å¥–åŠ±', time: "åˆšåˆš" });                
                lastRedeemTime = Date.now(); 
                
                save();                
                stream.getTracks().forEach(t => t.stop());                
                s.style.display = 'none';                
                alert("èº«ä»½æ ¸éªŒé€šè¿‡ï¼å…‘æ¢æˆåŠŸã€‚");            
            }        }, 70);    
    } catch(e) { 
        isScanning = false; 
        currentScanId = 0;
        if(scanTimer) clearInterval(scanTimer);
        alert("è¯†åˆ«æˆæƒå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ‘„åƒå¤´è®¾ç½®ã€‚"); 
    }
}

function goCrop(f) {    if (f.files && f.files[0]) {        const r = new FileReader();        r.onload = (e) => {            document.getElementById('target-img').src = e.target.result;            document.getElementById('modal-crop').style.display = 'flex';            if(cropper) cropper.destroy();            cropper = new Cropper(document.getElementById('target-img'), { aspectRatio: 1, viewMode: 1 });        };        r.readAsDataURL(f.files[0]);    }}
function doSaveAvatar() {    core.user.avatar = cropper.getCroppedCanvas({ width: 300, height: 300 }).toDataURL();    save(); hideModals();}
function updateProfile() { core.user.name = document.getElementById('edit-name').value; save(); alert("è´¦æˆ·èµ„æ–™åŒæ­¥æˆåŠŸ"); }function hideModals() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }function clearAll() { if(confirm("æ­¤æ“ä½œå°†æŠ¹é™¤æ­¤è®¾å¤‡ä¸Šçš„æ‰€æœ‰èµ„äº§æ•°æ®ä¸”ä¸å¯é€†ï¼ç¡®è®¤æ‰§è¡Œï¼Ÿ")) { localStorage.clear(); location.reload(); } }
window.onload = start;</script></body></html>